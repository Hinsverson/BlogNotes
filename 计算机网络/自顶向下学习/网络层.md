# 网络层
#计算机网络/哈工大自顶向下

![](%E7%BD%91%E7%BB%9C%E5%B1%82/27CC06B6-A108-4BE4-A068-6CC15EA0717D.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/49CA7B05-6CD3-4CED-A18C-6E9502A5B76A.png)

![](%E7%BD%91%E7%BB%9C%E5%B1%82/DEEF0A8D-F314-46B0-BE83-939362141773.png)

![](%E7%BD%91%E7%BB%9C%E5%B1%82/8DDBBF94-891B-4744-A1A1-6AF294B95019.png)

![](%E7%BD%91%E7%BB%9C%E5%B1%82/B2F8AA07-1F50-47EE-B1B3-D2663ABF9393.png)

# 虚电路网络
通信前建立虚电路，通信后拆除虚电路，虚电路建立后每个虚电路上的每一段都有虚电路标识，分组传输中都携带有虚电路标识，每个中间网络设备根据虚电路标识检索转发表并进行虚电路标识替换，最终让分组从原主机沿着某一条虚电路路径发送到目的主机。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/725C5675-C0AE-4E96-A397-039739FE4B1E.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/4B48F281-C644-45AB-8453-8FB319FF6DCF.png)
虽然采用分组交换，但是同时也能具备电路交换网络的性能保障。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/3E0A9BFF-EB61-4C2B-8E94-B8B67E9B0E75.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/2A852620-4612-4C09-A192-94879A39C600.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/BA8B441A-6AA8-48A4-9C05-44EE762ED727.png)

# 数据报网络
![](%E7%BD%91%E7%BB%9C%E5%B1%82/9E0872D3-56F5-42DA-B040-FC22724592B0.png)
每个数据报都携带着目的主机的地址，路由设备根据每个数据报的目的地址进行路由转发，所以数据报走的路径可能不一样，收到的数据报顺序并不确定。

![](%E7%BD%91%E7%BB%9C%E5%B1%82/33EC1D4C-5ECA-41BA-A245-25BE26D0F0A3.png)
IPv4地址为32位，大约40亿个，路由检索的时候会把符合某一范围的地址进行聚合，提高查表效率。

![](%E7%BD%91%E7%BB%9C%E5%B1%82/42C9201D-C8BB-4599-A90E-8CB1C963C412.png)

# 数据报网络和虚电路网络对比
![](%E7%BD%91%E7%BB%9C%E5%B1%82/56667FD6-228D-4723-826A-066865E68A66.png)

# IP协议
## Internet网络层主要构成？
![](%E7%BD%91%E7%BB%9C%E5%B1%82/67309C8D-9944-42D2-9C5D-7C5711D2B305.png)

## IP数据报格式？
![](%E7%BD%91%E7%BB%9C%E5%B1%82/81723188-1160-47D4-96D4-F2AB5BB196C7.png)
 典型的IP数据报是20字节。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/1FDB919F-4628-4A96-A798-87F7E74018DB.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/4DE9BB3D-771E-4332-9C3E-603A25C1093F.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/B84F46E6-A3F0-430A-B7F4-0090BDB60392.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/A5236A03-46FD-4404-9169-982546E1342F.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/3EDADFA7-AA33-4389-83EB-168F4764C7E1.png)
丢弃的时候会回送一个ICMP报文给原主机
![](%E7%BD%91%E7%BB%9C%E5%B1%82/83ADABFD-65F1-4CCC-85E8-A636C2F7C4F1.png)
指示当前数据报是包含的是TCP还是UDP数据段，是运输层实现复用和分用的前提。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202020-05-18%20%E4%B8%8B%E5%8D%8810.18.08.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/A0B2272D-A403-496E-8182-10925AE8DC25.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/C9D9F5AA-9AB2-4056-BAF4-195AB302FF3E.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/D2E1B57D-ACC9-4B0E-A77E-4FA709254864.png)

## IP分片
![](%E7%BD%91%E7%BB%9C%E5%B1%82/D93B6131-60F5-4F4F-A4A8-C9D103A83551.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/B6EC33A3-997D-4EC7-BCC5-90685B096CAC.png)

![](%E7%BD%91%E7%BB%9C%E5%B1%82/D4FECDFD-456C-4872-888E-BE4D6FF6E7EB.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/83223606-A13C-4684-A019-188AB5E8DA93.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/855F3DB2-2395-45F4-AF85-2E618060F0BC.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/B4061B59-87DD-46DC-BC1F-0FB78A825D23.png)
根据片偏移以8字节位单位，所以除了最后一片，前面的分片封装的数据字节数肯定是8的倍数。


![](%E7%BD%91%E7%BB%9C%E5%B1%82/86AF0465-A544-48E0-A43F-FEC6D1989B78.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/31C0F8BA-3381-43EA-AFBE-C6ECD64FB46F.png)
首部20个字节。

## IP地址
![](%E7%BD%91%E7%BB%9C%E5%B1%82/6C14FE97-50DD-46F7-9037-3FD855EA6ABF.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/7AF8F255-FCC6-422C-AE02-1535068C99CC.png)
每个接口进行IP编地

### IP地址划分中有规律的IP子网
![](%E7%BD%91%E7%BB%9C%E5%B1%82/403873F6-F722-4674-8FE8-867521DCCC38.png)
就是为每一个区域网络划分相同的网络号，路由时更高效。IP子网中不跨越路由器（也就是IP子网内的主机能直接相连）
![](%E7%BD%91%E7%BB%9C%E5%B1%82/C3D96645-6B8F-47FE-A35D-93707551C9BB.png)
一个大区域的子网，也能借用主机号的高位继续划分，划分后的子网信息被记录在路由设备上，以便高效路由。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/D6BA6FBC-F11E-4921-85C6-3DED24A9F029.png)
用子网掩码确定是否进行了子网划分。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/A856F6AC-BD37-4153-8ACF-A70A80CEB07F.png)
可分配地址是去除了特殊地址后的范围。

### IP地址划分
![](%E7%BD%91%E7%BB%9C%E5%B1%82/237021A2-55B0-4FA2-9C22-0135836B8110.png)
D类作为特殊地址，用作多播。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/4240756B-3AB3-4B04-83F3-F0392B2AF7CC.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/57AD5B90-142B-41AB-B1A4-F76997226FF1.png)
在公共网络中不可用，在内部网络中使用。

## CIDR
![](%E7%BD%91%E7%BB%9C%E5%B1%82/CFD66BDE-CDF0-4E51-8275-346773F035CF.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/34561D19-6412-4E8B-9DBC-1F637565BD3C.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/2E0B5961-FEB6-45DA-B60F-C5A60ACE8F5A.png)
CIDR简单理解就是不再按类型去划分地址，而是直接标注网络地址的位数，使用CIDR能方便的将多个子网聚合成一个较大的子网（超网），从而提高路由效率。

# DHCP
## Internet 主机如何静态/动态获取IP地址？
![](%E7%BD%91%E7%BB%9C%E5%B1%82/FF4D7AFC-2576-4F76-ADBC-07E65C19E96B.png)
静态获取：从网络管理人员那里获取一个明确的IP地址（223.1.0.0/25），通过静态配置完成IP地址的配置。
当子网内的数据报要离开子网时，需要送到哪个路由器上来完成转发，而这个路由器的IP地址就是默认网关。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/A3F0B8C1-AAE2-4464-A2FA-D17A37DB650E.png)
动态获取：通过应用层典型的CS网络架构方式实现，客户端主机运行DHCP协议，从网络服务端动态获取地址信息。

## DHCP动态地址获取的流程
![](%E7%BD%91%E7%BB%9C%E5%B1%82/FA973C38-BAA7-4670-8E54-88673BB00A20.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/23CB7206-3F1B-43AC-8B91-9367F5E01124.png)
### 为什么确定地址服务器后，请求地址时的报文里目标地址还是广播地址？
因为一个网络中可能不止有一个DHCP服务器，第二次广播请求地址的同时也是在告诉其他DHCP服务器我已经确定了某一个DHCP服务器为我提供IP地址，从而停止其他DHCP服务器的可能正在进行的地址资源分配，更高效的为其他主机进行地址分配。

报文的发送走的是UDP。

# NAT（网络地址转换）
主要解决私有地址在互联网中的通信。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/E9204708-0D53-4ECD-864E-B4FA708BBDFF.png)

## 提出NAT的动机？有什么好处？
![](%E7%BD%91%E7%BB%9C%E5%B1%82/333FE4D8-1263-4544-A12E-966875682943.png)

## NAT的简单实现原理
![](%E7%BD%91%E7%BB%9C%E5%B1%82/03534999-0AAC-4B47-BF81-3E0A61CA3085.png)
## NAT的争议
![](%E7%BD%91%E7%BB%9C%E5%B1%82/127F7AA1-3482-49D6-8D8E-A05AA02BE68A.png)

# ICMP（报文差错控制协议）
## 主要功能？
差错控制，网络探寻

![](%E7%BD%91%E7%BB%9C%E5%B1%82/B645F154-0CEE-456B-A341-FDDECA2CF8CA.png)
![](%E7%BD%91%E7%BB%9C%E5%B1%82/E1AB8D8F-41C9-4271-8F1C-B440C6C62552.png)

## ICMP报文格式
![](%E7%BD%91%E7%BB%9C%E5%B1%82/4F0D714D-E541-4E25-8BBA-C4533C628B63.png)

## ICMP封装过程
![](%E7%BD%91%E7%BB%9C%E5%B1%82/161D6F80-7D1E-4DD0-8989-35B9149639FE.png)

# IPV6
![](%E7%BD%91%E7%BB%9C%E5%B1%82/0CBC635D-FDF0-4C41-B382-7561A4306A67.png)

## IPV6数据报的格式？
![](%E7%BD%91%E7%BB%9C%E5%B1%82/53CBA04B-F5AE-4609-BC15-AD78952F1B0C.png)

## IPv6和IPv4的不同
![](%E7%BD%91%E7%BB%9C%E5%B1%82/9632C1CE-DA53-48B9-9023-993D22B5FF89.png)

##  IPv6地址表示（128位地址）
![](%E7%BD%91%E7%BB%9C%E5%B1%82/5D17F4B9-94C8-4EA9-845D-C609CBF87787.png)
不再使用掩码，而是使用无类地址CIDR标示主机地址位数。

## IPv6如果和IPv4共存的？
![](%E7%BD%91%E7%BB%9C%E5%B1%82/0DACB74F-0181-45E6-A264-034F459C378D.png)
简单说就是把IPv6数据报作为IPv4数据报的数据载荷，从而穿越IPv4网络。

# 路由算法
![](%E7%BD%91%E7%BB%9C%E5%B1%82/11E3BE3F-0DCD-4368-9E3F-EF6EAD0656D5.png)
转发表内的目的地址由路由算法生成。
![](%E7%BD%91%E7%BB%9C%E5%B1%82/CDE17501-8296-4509-96EF-2AD16797B756.png)

![](%E7%BD%91%E7%BB%9C%E5%B1%82/22B7C791-4B43-4ECF-A42D-DCE1844D6692.png)

