# 套接字
#计算机网络/哈工大自顶向下



![](%E5%A5%97%E6%8E%A5%E5%AD%97/0A4BA7EC-6FEE-4414-86AA-3207A55635B2.png)
应用层和传输层之间的一组网络接口。由操作系统进行下层实现，供应用层调用。


![](%E5%A5%97%E6%8E%A5%E5%AD%97/9E9C817A-1FC4-436A-91A8-12BE16C78ADB.png)
对外通过IP地址+端口号描述套接字，对内操作系统用描述符标示每一个套接字。吗
![](%E5%A5%97%E6%8E%A5%E5%AD%97/521D49CC-97D4-4116-837D-0B5A809C24CD.png)
 每个进程由操作系统维护一个它所创建的套接字表，表项就是每个套接字描述的数据结构。

![](%E5%A5%97%E6%8E%A5%E5%AD%97/C26CF309-12EB-4ECF-A234-D5C82990E260.png)
因为Socket不仅面向TCP/IP协议，也能适用于其他协议栈，不同协议栈的端点地址是不一样的（TCP/IP是用IP地址+端口号的方式）。所以不同的协议要指定不同的地址族，AF_INET表示TCP/IP的地址族。


![](%E5%A5%97%E6%8E%A5%E5%AD%97/842E2A02-8601-4D9D-B89A-2C508E32F248.png)
![](%E5%A5%97%E6%8E%A5%E5%AD%97/79E85573-E7E5-474D-B21B-65259ACB0E44.png)
PF_INET表示Internet协议族，也就是TCP/IP协议族。
SOCK_RAW表示创建的是一个原始的套接字类型，它跨越了传输层，直接和网络层交互，因此比较低层，能实现一些高级功能，一般需要系统root权限才能创建。
![](%E5%A5%97%E6%8E%A5%E5%AD%97/0AC2C2D0-5F79-48F3-A2FA-6576480B63AA.png)
关闭socket。注意理解Sock面向进程，而不是线程。
![](%E5%A5%97%E6%8E%A5%E5%AD%97/20D841DC-8246-46EB-8F4D-D348A6ACAD95.png)
![](%E5%A5%97%E6%8E%A5%E5%AD%97/9DF52D8B-D441-40E2-A466-A87817E0BEEF.png)
绑定端点地址和端口号，如果服务端有2个网卡，多个IP地址这种，那么bind地址时要使用INADDR_ANY地址通配符，表示在服务器上任何有效地址都能访问这个socket服务。 
![](%E5%A5%97%E6%8E%A5%E5%AD%97/FF67ABB0-6D45-433A-9C20-312BCCD7F7C6.png)
S端监听套接字状态。
![](%E5%A5%97%E6%8E%A5%E5%AD%97/78706781-F597-4030-9DC4-47B7F35513A5.png)
C端UDP调用connect的意思不是建立连接，而是指明了通信的端点地址。
![](%E5%A5%97%E6%8E%A5%E5%AD%97/FDA49582-DFB5-4E34-9183-83B4D30A79C8.png)
为什么是使用的是新的socket来和C端通信？因为TCP是点对点的，同时为了并发处理C端请求。
![](%E5%A5%97%E6%8E%A5%E5%AD%97/CEAEC377-E211-4459-8603-1C96006948B9.png)
Send没有端点地址，所以只适用于建立连接的TCP套接字（CS都可以）或者调用了connect的UDP客户端套接字。  

![](%E5%A5%97%E6%8E%A5%E5%AD%97/1DE0546C-CCE4-4B7C-95D9-DD1ECCF96741.png)
![](%E5%A5%97%E6%8E%A5%E5%AD%97/E0844AD1-A1FB-4A0B-AB64-AA98CABCAC2E.png)


为什要设置网络字节顺序？
![](%E5%A5%97%E6%8E%A5%E5%AD%97/91A7B560-2CBC-44CE-B8FB-20F3C2B4F568.png)
OS7层参考模式的表示层的作用就是把数据格式和标准化，在网络中也需要注意这个问题，并进行网络字节序和本地字节序间的互相转换。

网络应用典型socket调用基本流程？
![](%E5%A5%97%E6%8E%A5%E5%AD%97/C601FAE5-60A0-402D-8E5A-EE49FD2282B6.png)



