# 第三部分Capture14：安全的HTTPS
#计算机网络/HTTP

过数字密码来保护 HTTP 事务免受窃听和篡改的侵害 

## 14.1 保护HTTP的安全需要的功能 
* 服务器认证(客户端知道它们是在与真正的而不是伪造的服务器通话)。 
* 客户端认证(服务器知道它们是在与真正的而不是伪造的客户端通话)。
* 完整性(客户端和服务器的数据不会被修改)。
* 加密(客户端和服务器的对话是私密的，无需担心被窃听)。 
* 效率(一个运行的足够快的算法，以便低端的客户端和服务器使用)。 
* 普适性(基本上所有的客户端和服务器都支持这些协议)。
* 管理的可扩展性(在任何地方的任何人都可以立即进行安全通信)。
* 适应性(能够支持当前最知名的安全方法)。 
* 在社会上的可行性(满足社会的政治文化需要)。 

## 14.2 加密基本概念 
* 密码 
对文本进行编码，使偷窥者无法识别的算法。 
* 密钥 
改变密码行为的数字化参数。 
* 对称密钥加密系统
编 / 解码使用相同密钥的算法。 
* 不对称密钥加密系统
编 / 解码使用不同密钥的算法。 
* 公开密钥加密系统 
一种能够使数百万计算机便捷地发送机密报文的系统。 
* 数字签名 
用来验证报文未被伪造或篡改的校验和。 
* 数字证书
由一个可信的组织验证和签发的识别信息。 

## 14.7 HTTPS细节介绍 
HTTPS 将 HTTP 协议与一组强大的对称、非对称和 基于证书的加密技术结合在一起，使得 HTTPS 不仅很安全，而且很灵活，很容易 在处于无序状态的、分散的全球互联网上进行管理。 

### 14.7.1 HTTPS概述 
HTTPS 就是在安全的传输层上发送的 HTTP。它在将 HTTP 报文发送给 TCP 之前，先将其发送给了一个安全层，对其进行加密(参见 图 14-13b)。 

现在，HTTP 安全层是通过 SSL 及其现代替代协议 TLS 来实现的。我们遵循常见的 用法，用术语 SSL 来表示 SSL 或者 TLS。 
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture14%EF%BC%9A%E5%AE%89%E5%85%A8%E7%9A%84HTTPS/635CBEFC-7DE7-4DF4-8C2D-3F99E8675CA8.png)
大部分困难的编码及解码工作都是在 SSL 库中完成的，所以 Web 客户端和服务器在使用安全 HTTP 时无需过多地修改其协议处理逻辑。在大多数情况下，只需要用 SSL 的输入 / 输出调用取代 TCP 的调用，再增加其他几个调用来配置和管理安全信息就行了。

### 14.7.2 HTTPS方案 
请求一个客户端(比如 Web 浏览器)对某 Web 资源执行某事务时，它会去检查 URL 的方案。 

* 如果 URL 的方案为 http，客户端就会打开一条到服务器端口 80(默认情况下) 的连接，并向其发送老的 HTTP 命令(参见图 14-14a)。 
* 如果 URL 的方案为 https，客户端就会打开一条到服务器端口 443(默认情况下) 的连接，然后与服务器“握手”，以二进制格式与服务器交换一些 SSL 安全参数， 附上加密的 HTTP 命令(参见图 14-14b)。
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture14%EF%BC%9A%E5%AE%89%E5%85%A8%E7%9A%84HTTPS/457FDF85-A391-41D7-967A-32358B1D7B1F.png)

###  14.7.3 HTTPS如何建立安全传输
在未加密 HTTP 中，客户端会打开一条到 Web 服务器端口 80 的 TCP 连接，发送一 条请求报文，接收一条响应报文，关闭连接。图 14-15a 对此序列进行了说明。 

*由于 SSL 安全层的存在，HTTPS 中这个过程会略微复杂一些*
1. 客户端首先打开一条到 Web 服务器端口 443(安全 HTTP 的默认端口)的连接。
2. 一旦建立了 TCP 连接，客户端和服务器就会初始化 SSL 层，对加密参数进行沟通，并交换密钥，握手完成之后，SSL 初始化就完成了，客户端就可以将请求报文发送给安全层了。
3. 在将这些报文发送给 TCP 之前，要先对其进行加密。

### 14.7.4 SSL握手的基本思想
在发送已加密的 HTTP 报文之前，客户端和服务器要进行一次 SSL 握手，在这个握手过程中，它们要完成以下工作: 

* 交换协议版本号
* 选择一个两端都了解的密码
* 对两端的身份进行认证
* 生成临时的会话密钥，以便加密信道

![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture14%EF%BC%9A%E5%AE%89%E5%85%A8%E7%9A%84HTTPS/AA7EBF0A-3C80-42C2-92B2-E51FDB2F02C8.png)

### 14.7.5 安全 HTTPS 事务总是要求使用服务器证书
SSL 支持双向认证，将服务器证书承载回客户端，再将客户端的证书回送给服务器。 而现在，浏览时并不经常使用客户端证书。大部分用户甚至都没有自己的客户端证书。另一方面，安全 HTTPS 事务总是要求使用服务器证书的。 





