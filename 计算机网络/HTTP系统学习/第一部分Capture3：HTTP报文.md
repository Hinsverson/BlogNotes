# 第一部分Capture3：HTTP报文
#计算机网络/HTTP

*掌握知识点*
1. 报文是如何流动的; 
2. HTTP报文的三个组成部分(起始行、首部和实体的主体部分); 
3. 请求和响应报文之间的区别; 
4. 请求报文支持的各种功能(方法); 
5. 和响应报文一起返回的各种状态码; 
6. 各种各样的 HTTP 首部都是用来做什么的; 

# 3.1 报文流 
HTTP 报文是在 HTTP 应用程序之间发送的数据块，这些数据块以一些文本形式的元信息(meta-information)开头，这些信息描述了报文的内容及含义，后面跟着可选的数据部分。 

# 3.1.1 报文流入源端服务器 
HTTP 使用术语流入(inbound)和流出(outbound)来描述事务处理。(transaction) 的方向。 
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/4FFDA342-5F9A-4DFB-B010-B4628AA199E6.png)

# 3.1.2 报文向下游流动 
HTTP 报文会像河水一样流动。不管是请求报文还是响应报文，所有报文都会向下游(downstream)流动(参见图 3-2)。所有报文的发送者都在接收者的上游 (upstream)。 
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/87E24B0F-9336-497C-95CE-ED903227300D.png)

# 3.2 报文的组成部分 
无论请求还是响应，报文由三个部分组成：
1. 对报文进行描述的起始行(start line)
2. 包含属性的首部(header)块
3. 以及可选的、包含数据的主体(body)部分。 
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/F30C5079-2205-4D29-8A5B-3ED1F6860998.png)

# 3.2.1 报文的语法 
## 这是请求报文的格式:
请求：
<method> <request-URL> <version> <headers> 
<entity-body> 
响应：
<version> <status> <reason-phrase> <headers> 
<entity-body> 

* 方法(method)
客户端希望服务器对资源执行的动作。是一个单独的词，比如 GET、HEAD 或 POST。 
* 请求 URL(request-URL)
命名了所请求资源，或者 URL 路径组件的完整 URL。 
* 版本(version)
报文所使用的 HTTP 版本 
* 状态码(status-code) 
每个状态码的第一位数字都用于描述状态的一般类别(“成功”、“出错”等)，整体描述了请求过程中所发生的情况。
* 原因短语(reason-phrase) 
数字状态码的可读版本，包含行终止序列之前的所有文本。 
* 首部(header) 
可以有零个或多个首部，每个首部都包含一个名字，后面跟着一个冒号(:)，然后是一个可选的空格，接着是一个值，最后是一个 CRLF。 
* 实体的主体部分(entity-body) 
包含一个由任意数据组成的数据块。 

# 3.2.2 起始行
所有的 HTTP 报文都以一个起始行作为开始，请求报文的起始行说明了要做些什么，响应报文的起始行说明发生了什么。 

1.请求行
一般包含了一个方法和一个请求URL、HTTP版本号。

2.响应行
承载了状态信息和操作产生的所有结果数据，将其返回给客户端 。

3.方法
方法是用来告诉服务器做什么事情的
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/B343B292-AFE9-441C-A34D-1781A286EA10.png)

4.状态码
状态码则用来告诉客户端，发生了什么事情。 
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/D63A380B-4ED3-4C0F-841B-9C0175A0521D.png)
200 到 299 之间的状态码表示成功。 300 到 399 之间的代码表示资源已经被移走了。400 到 499 之间的代码表示客户端 的请求出错了。500 到 599 之间的代码表示服务器出错了 

5.原因短语 
它为状态码提供了文本形式的解释。

6.版本号
使用版本号的目的是为使用 HTTP 的应用程序提供一种线索，以便互相了解对方的 能力和报文格式。

# 3.2.3 首部 
跟在起始行后面的零个、一个或多个 HTTP 首部字段，主要用来向请求和响应报文中添加了一些附加信息，格式类似键值对。

如下：表示HTTP实体主体的长度
```
Content-length:19 
```

*关于HTTP报文主体和实体主体的区别*
> 引用：HTTP实体主体在运输过程中进行编码的时候，实体内容发生了变化，才导致他和报文主体产生差异，参考自《图解HTTP中作者的注解》  
> 报文： 网络传输的单位，传输过程中会不断的 封装成分组、包、帧来传输，封装的方式就是添加一些信息段，那些就是报文头以一定格式组织起来的数据。  

*我的理解就是：*
实体和报文
* 实体（一个HTTP传输的基本单位）在网络传输中由于会发生很多变化为了加以区别所以称为报文（一般把报文当成计算机网络传输的基本单位）, 用来传输的叫报文，其他阶段都叫它实体。
* 主体：就是实际网络交换中有意义的数据块。

1. 首部分类

* 通用首部：既可以出现在请求报文中，也可以出现在响应报文中。 
* 请求首部：提供更多有关请求的信息。 
* 响应首部：提供更多有关响应的信息。 
* 实体首部：描述主体的长度和内容，或者资源自身。 
* 扩展首部：规范中没有定义的新首部。 

语法：名字后面跟着冒号( :)，然后跟上可选的空格，再跟上字段值，最后是一个 CRLF 。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/1E5B9BAD-B349-45E7-AB63-08B77EA89918.png)

2. 首部延续行 
即：将长的首部行分为多行，可以提高可读性。多出来的每行前面至少要有一个空格或制表符(tab)。
```
HTTP/1.0 200 OK 
Content-Type: image/gif 
Content-Length: 8572 
	Server: Test Server 
		Version 1.0 
```

### 3.2.4 实体的主体部分 
就是HTTP实际要传输的内容：图片、视频、HTML 文档、电子邮件等。

## 3.3 方法 
### 3.3.1 安全方法
请求不会在服务器上产生什么结果，例如：GET、HEAD方法

### 3.3.2 GET 
请求服务器发送某个资源（HTTP1.1中必须实现）
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/65A413EA-04F9-4DFF-98F6-A497B409CEC8.png)

### 3.3.3 HEAD 
和GET类似（服务端应确保返回的首部和GET请求返回的首部保持一致），只是响应报文内不包含实体主体。

* 在不获取资源的情况下了解资源的情况(比如，判断其类型); 
* 通过查看响应中的状态码，看看某个对象是否存在;
* 通过查看首部，测试资源是否被修改了。 
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/C25C4DC9-ED9F-41A0-AE3D-5AD0BD564697.png)

### 3.3.4 PUT 
将请求的主体资源存储在服务器上，向服务器上的资源(例如文件)中存储数据，PUT之前一般需求登录。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/76B13EC1-CFEE-4E2E-A8AA-8E26F067D70A.png)

### 3.3.5 POST 
向服务器发送需要处理的数据。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/58D7C779-2562-464B-A347-E6F870E9DAF7.png)

### 3.3.6 TRACE 
主要用于对可能经过代理服务器传送到服务器上的报文进行“环回”诊断 ，检察报文是如何被毁坏或修改的。

环回原理：
最后一站服务器会弹回一条 TRACE 响应，并在响应主体中携带它收到的请求报文，通过和初始报文对比即可检察报文是如何被毁坏或修改的。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/A1DF329B-F73C-4906-8E8A-7BADB967872F.png)

缺点：
1.TRACE 请求中不能带有实体的主体部分 
2.TRACE 不提供区分（GET、HEAD、POST 等 ）这些方法的机制 

### 3.3.7 OPTIONS 
OPTIONS 方法请求 Web 服务器告知其支持的各种功能 。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/3F958670-ECDF-4C21-8811-FA71EBE6E549.png)

3.3.8 DELETE 
请服务器删除请求 URL 所指定的资源，但不一定会真的删除。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/5FA31FF3-4D5C-4BFF-9C90-B3DE548706E1.png)

3.3.9 扩展方法 
自定义的拓展HTTP的方法。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/1F810304-7E2B-4009-95F1-1379BE9E49DD.png)

3.5 首部 

3.5.1 通用首部 
请求和响应报文内都提供同样信息
信息相关：
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/61EBFA91-53BC-45A8-81D2-B9636AD9719F.png)
缓存相关：
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/66E9265C-5663-442F-A783-5DED82FF93E5.png)

3.5.2 请求首部
只在请求报文中有意义的首部，一般说明是谁或什么在发送请求、请求源自何处，或者客户端的喜好及能力。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/6A626CCD-8D64-4A8B-B15A-38B9C578FC73.png)
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/C309F197-3BBC-4723-BEC2-BFAF22DD7258.png)
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/9E4F1D0E-ECB6-47D4-A3AA-6EB2EE497808.png)
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/52D14354-ACB3-41E8-892B-E650699C5581.png)
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/784A5666-6575-4E18-89C3-2F78DCC3E86A.png)

3.5.3 响应首部 
响应首部为客户端提供了一些额外信息，比如谁在 发送响应、响应者的功能，甚至与响应相关的一些特殊指令。
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/6903AAA7-6904-40D5-9010-43F1ED5B4EDF.png)
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/9C5589FC-4B25-4324-A816-0B6118608DE6.png)
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/D9A2CB86-3E53-4C61-95E2-DF1CB0DD5467.png)


3.5.4 实体首部
提供了有关实体及其内容的大量信息，从有关对象类型的信息，到能够对资源使用的各种有效的请求方法 
![](%E7%AC%AC%E4%B8%80%E9%83%A8%E5%88%86Capture3%EF%BC%9AHTTP%E6%8A%A5%E6%96%87/6F72618F-3962-4186-A815-F8DEBA6A65BD.png)

























