# 第三部分Capture12：基本认证机制  
#计算机网络/HTTP

## 12.1 HTTP 认证的概念 
认证就是要给出一些身份证明。当出示像护照或驾照那样有照片的身份证件时，就 给出了一些证据，说明你就是你所声称的那个人。 HTTP 定义了两个官方的认证协议:基本认证和摘要认证。 

### 12.1.1 认证协议与首部 
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/494BD6CD-0C2B-40FC-BFED-0B3B0FD9978F.png)
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/2F4B41B4-2534-450C-92A6-54FBC70BF24B.png)

### 12.1.2 HTTP 基本认证的过程
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/3A6F1A13-409E-453C-90B4-CF2394F264D5.png)
* 服务器对用户进行质询时，会返回一条 401 Unauthorized 响应，并在 WWW-Authenticate 首部说明如何以及在哪里进行认证(参见图 12-2b)。 
* 当客户端授权服务器继续处理时，会重新发送请求，但会在 Authorization 首部附上加密的密码和其他一些认证参数(参见图 12-2c)。 
* 授权请求成功完成时，服务器会返回一个正常的状态码(比如，200 OK)，对高级认证算法来说，可能还会在 Authentication-Info 首部附加一些额外的信息(参见图 12-2d)。 

### 12.1.3 安全域
HTTP 是怎样允许服务器为不同的资源使用不同的访问权限。图 12-2b 的 WWW- Authenticate 质询中包含了一个 realm 指令。Web 服务器会将受保护的文档组织 成一个安全域(security realm)。每个安全域都可以有不同的授权用户集。 

![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/501FEF9F-A9BC-4502-B720-AFC8C016F6C1.png)
指定安全域为 “Corporate Financials ”以帮助用户了解应该使用哪个用户名和密码。

## 12.2 基本认证 
基本认证是最流行的 HTTP 认证协议。几乎每个主要的客户端和服务器都实现了基本认证机制。

在基本认证中，Web 服务器可以拒绝一个事务，质询客户端，请用户提供有效的用 户名和密码。服务器会返回 401 状态码，而不是 200 状态码来初始化认证质询，并用 WWW-Authenticate 响应首部指定要访问的安全域。浏览器收到质询时，会打开 一个对话框，请求用户输入这个域的用户名和密码。然后将用户名和密码稍加扰码， 再用 Authorization 请求首部回送给服务器。 

### 12.2.1 基本认证实例
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/3A6F1A13-409E-453C-90B4-CF2394F264D5%202.png)
* 在图 12-2a 中，用户请求了私人家庭相片 /family/jeff.jpg。 
* 在图 12-2b 中，服务器回送一条 401 Authorization Required，对私人家庭相片 进行密码质询，同时回送的还有 WWW-Authenticate 首部。这个首部请求对 Family 域进行基本认证。 
* 在图 12-2c 中，浏览器收到了 401 质询，弹出对话框，询问 Family 域的用 
户名和密码。用户输入用户名和密码时，浏览器会用一个冒号将其连接起 来，编码成“经过扰码的”Base-64 表示形式(下节介绍)，然后将其放在 Authorization 首部中回送。 
* 在图 12-2d 中，服务器对用户名和密码进行解码，验证它们的正确性，然后用一 条 HTTP 200 OK 报文返回所请求的报文。 

### 12.2.2 Base-64 用户名/密码编码 
HTTP 基本认证将(由冒号分隔的)用户名和密码打包在一起，并用 Base-64 编码方式对其进行编码。 Base-64 编码扰乱了用户名和密码（并不能防止恶意拦截破解），这样也可以防止管理员在管理服务器和网络时，不小心看到用户名和密码。 
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/A4A61CB3-A890-4E1C-AA2F-CAC70BF419FE.png)

### 12.2.3 代理认证 
中间的代理服务器也可以实现认证功能。有些组织会在用户访问服务器、LAN 或无 线网络之前，用代理服务器对其进行认证。 
代理认证的步骤与 Web 服务器身份验证的步骤相同。但首部和状态码都有所不同。
![](%E7%AC%AC%E4%B8%89%E9%83%A8%E5%88%86Capture12%EF%BC%9A%E5%9F%BA%E6%9C%AC%E8%AE%A4%E8%AF%81%E6%9C%BA%E5%88%B6/2FE02F15-2D68-44C9-9B0F-C65694F89284.png)

## 12.3 基本认证的安全缺陷 
基本认证简单便捷，但并不安全，只能用它来防止非恶意用户无意间进行的访问。*安全使用基本认证的唯一方式就是将其与 SSL 配合使用。* 
 

* 基本认证会通过网络发送用户名和密码，这些用户名和密码都是以一种很容易解码的形式表示的。 
* 即使密码是以更难解码的方式加密的，第三方用户仍然可以捕获被修改过的用户名和密码，并将修改过的用户名和密码一次一次地重放给原始服务器，以获得对服务器的访问权。没有什么措施可用来防止这些重放攻击。 
* 基本认证没有提供任何针对代理和作为中间人的中间节点的防护措施，它们没有修改认证首部，但却修改了报文的其余部分，这样就严重地改变了事务的本质。 
* 假冒服务器很容易骗过基本认证。如果在用户实际连接到一台恶意服务器或网关的时候，能够让用户相信他连接的是一个受基本认证保护的合法主机，攻击者就可以请求用户输入密码，将其存储起来以备未来使用，然后捏造一条错误信息传 送给用户。 





 









